<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="../../style.css">
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
      integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm"
      crossorigin="anonymous"
    />
    <title>SignUp</title>
  </head>
  <body>
    <nav class="navbar sticky">
      <div class="max-width">
          <div class="logo"><a href="#">Joh<span>n.</span></a></div>
          <ul class="menu" id="menu">
              <li><a href="../../index.html#home" class="menu-btn">Home</a></li>
              <li><a href="../../index.html#about" class="menu-btn">About</a></li>
              <li><a href="../../index.html#services" class="menu-btn">Projects</a></li>
              <li><a href="../../index.html#skills" class="menu-btn">Skills</a></li>
              <li><a href="./pages/blogMain.html" class="menu-btn">Blog</a></li>
              <li><a href="../../index.html#contact" class="menu-btn">Contact</a></li>
              <li><a href="./pages/login/index.html" class="menu-btn">Login</a></li>
          </ul>
          <div class="menu-btn" id="burger-menu">
              <span></span>
          </div>
      </div>
  </nav>

    <div class="container">
      <div class="content">
      <form id="form" >
        <div class="social">
          <div class="login-title">Create Account</div>
        <div>
          <label for="email">Email</label>
          <i class="far fa-envelope"></i>
          <input
            type="email"
            name="email"
            id="email"
            placeholder="Enter your email" required
          />
          <i class="fas fa-exclamation-circle failure-icon"></i>
          <i class="far fa-check-circle success-icon"></i>
          <div class="error"></div>
        </div>
        <div>
          <label for="password">Password</label>
          <i class="fas fa-lock"></i>
          <input
            type="password"
            name="password"
            id="password"
            placeholder="Enter password" 
          />
          <i class="fas fa-exclamation-circle failure-icon"></i>
          <i class="far fa-check-circle success-icon"></i>
          <div class="error"></div>
        </div>
        <div>
          <label for="password">Confirm Your Password</label>
          <i class="fas fa-lock"></i>
          <input
            type="password"
            name="passwordConfirm"
            id="passwordConfirm"
            placeholder="Enter password again" 
          />
          <i class="fas fa-exclamation-circle failure-icon"></i>
          <i class="far fa-check-circle success-icon"></i>
          <div class="error"></div>
        </div>
        <a> <button type="submit" id="submit">Sign Up</button> </a>Have an account?
        <a href="./index.html" class="signup-link">Login</a> <br>
        <a href="./index.html" class="signup-link">Go Home</a>

      </form>
    </div>
  </body>
  <script>
        let id = (id) => document.getElementById(id);

        let classes = (classes) => document.getElementsByClassName(classes);

        let email = id("email"),
          password = id("password"),
          passwordConfirm = id("passwordConfirm"),
          form = id("form"),
          errorMsg = classes("error");

        form.addEventListener("submit", (e) => {
          e.preventDefault();

          //check for emptyness
          engine(email, 0, "Email cannot be blank");
          engine(password, 1, "Password cannot be blank");
          engine(passwordConfirm, 2, "Password don't match!");

          //check the length
         lengthEngine(password, 1 , "Password should be at least 8 characters")
         
         //Check if the password matches the confirm passwords
         checkPasswordMatch(password, passwordConfirm , 2 , "Password Don't Match!")

         register(email.value,password.value)
        });

        let engine = (id, serial, message) => {
          if (id.value.trim() === "") {
            errorMsg[serial].innerHTML = message;
            id.style.border = "2px solid red";
            return false;
          } else {
            errorMsg[serial].innerHTML = "";
            id.style.border = "2px solid green";
            return true;
          }
        };

        let lengthEngine = (id, serial, message) => {
          if (id.value.length < 8) {
            errorMsg[serial].innerHTML = message;
            id.style.border = "2px solid red";
            return false;
          } else {
            errorMsg[serial].innerHTML = "";
            id.style.border = "2px solid green";
            return true;
          }
        };

        let checkPasswordMatch = (password, passwordConfirm, serial, message) => {
          if (password.value !== passwordConfirm.value ) {
            errorMsg[serial].innerHTML = message;
            passwordConfirm.style.border = "2px solid red";
            return false;
          } else {
            errorMsg[serial].innerHTML = "";
            passwordConfirm.style.border = "2px solid green";
            return true;
          }
        };

      const register = (email, password) =>{
        let url = "https://john-my-brand.herokuapp.com/signup";
         fetch(url,{
          method: 'POST',
           headers:{
            "Accept":"application/json, text/plain, */*",
             'Content-Type': "application/json"
           },
           body: JSON.stringify({email:email, password:password})
         }).then(res=>{
           if(res.ok){
             return res.json();
           }else{
             alert("Could not connect to the server")
           }
         }).then(data =>{
            alert(`${data.Message}`)
            window.location.replace("index.html")
         })
      }

  </script>
</html>
