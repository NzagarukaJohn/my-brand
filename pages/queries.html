<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="../style.css" />
    <title>Super Blog</title>
  </head>
  <body>
    <nav class="navbar sticky">
      <div class="max-width">
        <div class="logo">
          <a href="#">Joh<span>n</span></a>
        </div>
            <ul class="menu" id="menu">
         
          <li><a href="./dashboard.html" class="menu-btn">Dashboard</a></li>
          <li>
            <a href="./new-article.html" class="menu-btn">New Article</a>
          </li>
          <li><a href="./queries.html" class="menu-btn">Queries</a></li>
          <li><a href="logout.html" class="menu-btn">Logout</a></li>
        </ul>
            <div class="menu-btn" id="burger-menu">
                <span></span>
            </div>
      </div>
    </nav>
    <main>
      <section class="container">
          <div class="card query-card-queries">
            <h3 class="card-title">Queries</h3>
            <div class="card-body">
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>subject</th>
                            <th>Body</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>
      </section>
      <footer>
        <span
          >Created By <a href="#">John</a> |
          <span class="far fa-copyright"></span> 2021
        </span>
      </footer>
    </main>
    <script >
      document.addEventListener("DOMContentLoaded",function(){
          viewQueries()
      })
      function viewQueries(){
        let bearer = `Bearer ${localStorage.getItem("token")}`;
        fetch("https://john-my-brand.herokuapp.com/query",{
          headers:{
            'Authorization': bearer
          }
        })
         .then(res=>res.json())
         .then(queries =>{
          if(queries && queries.length > 0){
              queries.forEach((query,idx)=>{
                  let queryEl = `
                       <tr>
                            <td>
                                ${query.name}
                            </td>
                            <td>
                                ${query.email}
                            </td>
                            <td>
                               ${query.subject}
                            </td>
                            <td>
                                ${query.message}
                            </td>
                        </tr>
                  `;
         let tr = document.createElement('tr');
         
        var doc = new DOMParser().parseFromString(queryEl, 'text/html');
         tr.innerHTML = queryEl;
          document.querySelector('tbody').appendChild(tr);
          });
      }
    })
      }
  </script>
  
  <script>
      
    var burgerMenu = document.getElementById("burger-menu");
    var overlay = document.getElementById("menu");
    burgerMenu.addEventListener("click", function () {
      this.classList.toggle("close");
      overlay.classList.toggle("active");
    });

    const checkLog = () =>{
        let token = localStorage.getItem("token");
        if(token == null){
            window.location.replace("login/index.html");
        }
      }

checkLog();
    
        </script>
  </body>
</html>
